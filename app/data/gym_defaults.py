from __future__ import annotations

import re
from datetime import date

LAST_WEEK_DATE = date(2025, 11, 16).isoformat()

MUSCLE_GROUPS = [
    "Chest",
    "Back",
    "Shoulders",
    "Rear Delts",
    "Side Delts",
    "Triceps",
    "Biceps",
    "Quads",
    "Hamstrings",
    "Glutes",
    "Calves",
    "Abs",
    "Core",
    "Full Body",
]

JEFF_SET_TARGETS = {
    "chest": "8–12 sets / week",
    "back": "10–14 sets / week",
    "shoulders": "6–10 sets / week",
    "triceps": "6–8 sets / week",
    "biceps": "6–8 sets / week",
    "quads": "10–16 sets / week",
    "hamstrings": "8–12 sets / week",
    "glutes": "6–10 sets / week",
    "calves": "6–8 sets / week",
    "abs": "6–10 sets / week",
}

def _normalize_key(label: str) -> str:
    return label.lower().replace(" ", "")


_RANGE_RE = re.compile(r"(\d+)")


def _parse_range(text: str) -> dict[str, int]:
    digits = [int(match) for match in _RANGE_RE.findall(text.replace("–", "-"))]
    if len(digits) >= 2:
        return {"low": digits[0], "high": digits[1]}
    if digits:
        return {"low": digits[0], "high": digits[0]}
    return {"low": 0, "high": 0}


DEFAULT_MUSCLE_TARGETS = {
    label: _parse_range(JEFF_SET_TARGETS.get(_normalize_key(label), "6-10"))
    for label in MUSCLE_GROUPS
}

DEFAULT_EXERCISES: dict[str, dict] = {
    "warmup_mobility": {
        "id": "warmup_mobility",
        "name": "Dynamic Warm-up",
        "equipment": "Bodyweight + bands",
        "muscle_groups": ["Full Body"],
        "primary_muscle": "Full Body",
        "secondary_muscle": "",
        "last_session": [],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": (
            "Keep heart rate around 120 bpm and focus on shoulder circles, band pull-aparts, and ankle mobility for 8–10 minutes."
        ),
        "cues": [
            "Start with light cardio (jumping jacks) before moving joints through active ranges.",
            "Jeff Nippard recommends movement-specific warm-up, so mimic the pressing and pulling angles you will use later.",
        ],
        "mistakes": ["Skipping warm-up or rushing through mobility drills."],
        "rest_seconds": 0,
        "swap_suggestions": [
            {"name": "Rowing machine (5 min)", "detail": "Great if you need more back activation before pull-ups."},
            {"name": "Assault bike 3×30s", "detail": "Add if you want extra conditioning."},
        ],
    },
    "pushups_standard": {
        "id": "pushups_standard",
        "name": "Push-ups",
        "equipment": "Bodyweight / floor",
        "muscle_groups": ["Chest", "Triceps", "Core"],
        "primary_muscle": "Chest",
        "secondary_muscle": "Triceps",
        "last_session": [
            {"set": 1, "weight": "BW", "reps": 12},
            {"set": 2, "weight": "BW", "reps": 12},
            {"set": 3, "weight": "BW", "reps": 12},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Aim to add a slow eccentric or elevate feet for a harder variation if all sets felt easy.",
        "cues": [
            "Hands slightly outside shoulder width, screw palms into the floor.",
            "Keep ribs tucked and glutes tight to prevent sagging.",
        ],
        "mistakes": ["Letting elbows flare past 60°", "Hips sagging or piked up"],
        "rest_seconds": 60,
        "swap_suggestions": [
            {"name": "Smith machine push-ups", "detail": "Adjust bar height if floor space is busy."},
            {"name": "Incline dumbbell press", "detail": "Great if you want to load the movement instead."},
        ],
    },
    "bench_press_barbell": {
        "id": "bench_press_barbell",
        "name": "Barbell Bench Press",
        "equipment": "Flat bench + barbell",
        "muscle_groups": ["Chest", "Triceps", "Front Delts"],
        "primary_muscle": "Chest",
        "secondary_muscle": "Triceps",
        "last_session": [
            {"set": 1, "weight": 40, "reps": 12},
            {"set": 2, "weight": 45, "reps": 10},
            {"set": 3, "weight": 50, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Add 2.5 kg to the top set or push for +1 rep while maintaining bar speed.",
        "cues": [
            "Retract scapula, drive feet into the floor (Jeff’s full-body bench).",
            "Lower with control for ~2 seconds, slight pause, then press hard.",
        ],
        "mistakes": ["Bouncing off the chest", "Losing leg drive", "Not keeping wrists stacked."],
        "rest_seconds": 150,
        "swap_suggestions": [
            {"name": "Smith machine bench", "detail": "Use if the main bench is occupied."},
            {"name": "Dumbbell bench press", "detail": "Great for unilateral balance and shoulder comfort."},
        ],
    },
    "assisted_pullup": {
        "id": "assisted_pullup",
        "name": "Assisted Pull-ups",
        "equipment": "Assisted chin-up machine",
        "muscle_groups": ["Back", "Biceps"],
        "primary_muscle": "Back",
        "secondary_muscle": "Biceps",
        "last_session": [
            {"set": 1, "weight": -35, "reps": 8},
            {"set": 2, "weight": -30, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Reduce assistance by ~5 kg or hold the top for 2 s each rep.",
        "cues": [
            "Think pull elbows to ribs.",
            "Keep chest tall and avoid swinging—use the foot plate lightly.",
        ],
        "mistakes": ["Letting shoulders shrug up", "Half range of motion"],
        "rest_seconds": 120,
        "swap_suggestions": [
            {"name": "Lat pulldown (wide grip)", "detail": "Use if the assisted machine is taken."},
            {"name": "Band-assisted pull-ups", "detail": "Bring your own band for flexibility."},
        ],
    },
    "lat_pulldown": {
        "id": "lat_pulldown",
        "name": "Lat Pulldown",
        "equipment": "Cable tower",
        "muscle_groups": ["Lats", "Upper Back"],
        "primary_muscle": "Lats",
        "secondary_muscle": "Upper Back",
        "last_session": [
            {"set": 1, "weight": 25, "reps": 12},
            {"set": 2, "weight": 30, "reps": 10},
            {"set": 3, "weight": 35, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Match last week then add +2.5 kg to the final set or focus on 1-second squeezes.",
        "cues": [
            "Slight lean back with chest proud.",
            "Drive elbows down and think pull the bar to your sternum.",
        ],
        "mistakes": ["Rocking body excessively", "Stopping short of chest level"],
        "rest_seconds": 90,
        "swap_suggestions": [
            {"name": "Single-arm cable pulldown", "detail": "Great for focusing on lat stretch."},
            {"name": "Straight-arm pulldown", "detail": "Use as a finisher if main stack busy."},
        ],
    },
    "smith_shoulder_press": {
        "id": "smith_shoulder_press",
        "name": "Smith Machine Shoulder Press",
        "equipment": "Smith machine",
        "muscle_groups": ["Shoulders", "Triceps"],
        "primary_muscle": "Shoulders",
        "secondary_muscle": "Triceps",
        "last_session": [
            {"set": 1, "weight": 20, "reps": 10},
            {"set": 2, "weight": 25, "reps": 8},
            {"set": 3, "weight": 25, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Try to keep RIR at ~2. Add 2.5 kg if last week felt smooth.",
        "cues": ["Stack wrists over elbows", "Drive head through at the top", "Control tempo 2-1-1"],
        "mistakes": ["Pressing too low (toward chest)", "Arching lower back excessively"],
        "rest_seconds": 120,
        "swap_suggestions": [
            {"name": "Dumbbell seated press", "detail": "If Smith is taken, grab DBs."},
            {"name": "Arnold press", "detail": "Adds more front delt involvement."},
        ],
    },
    "tricep_rope_pushdown": {
        "id": "tricep_rope_pushdown",
        "name": "Tricep Rope Pushdown",
        "equipment": "Cable tower",
        "muscle_groups": ["Triceps"],
        "primary_muscle": "Triceps",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 15, "reps": 12},
            {"set": 2, "weight": 20, "reps": 10},
            {"set": 3, "weight": 25, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Hold the peak contraction for a full second each rep before adding load.",
        "cues": ["Lock elbows by your sides", "Flare rope at the bottom"],
        "mistakes": ["Letting elbows drift forward", "Using too much torso momentum"],
        "rest_seconds": 75,
        "swap_suggestions": [
            {"name": "Overhead cable extension", "detail": "Great long-head emphasis."},
            {"name": "Dip machine", "detail": "Use if cables are packed."},
        ],
    },
    "db_biceps_curl": {
        "id": "db_biceps_curl",
        "name": "Dumbbell Biceps Curl",
        "equipment": "Dumbbells",
        "muscle_groups": ["Biceps"],
        "primary_muscle": "Biceps",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 5, "reps": 12},
            {"set": 2, "weight": 7.5, "reps": 10},
            {"set": 3, "weight": 10, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Try to hit +1 rep on the top set or slow the eccentric to 3 seconds.",
        "cues": ["Pin elbows to ribs", "Rotate pinkies up at the top"],
        "mistakes": ["Swinging torso", "Not fully extending elbows"],
        "rest_seconds": 60,
        "swap_suggestions": [
            {"name": "Hammer curls", "detail": "Keeps forearms happier if wrists ache."},
            {"name": "Cable curls (rope)", "detail": "Constant tension alternative."},
        ],
    },
    "bodyweight_squat": {
        "id": "bodyweight_squat",
        "name": "Bodyweight Squats",
        "equipment": "Bodyweight",
        "muscle_groups": ["Quads", "Glutes"],
        "primary_muscle": "Quads",
        "secondary_muscle": "Glutes",
        "last_session": [
            {"set": 1, "weight": "BW", "reps": 40},
            {"set": 2, "weight": "BW", "reps": 30},
            {"set": 3, "weight": "BW", "reps": 30},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Add tempo (3-1-1) or hold a 10 kg plate goblet-style for added challenge.",
        "cues": ["Push knees out", "Keep whole foot planted"],
        "mistakes": ["Collapsing knees inward"],
        "rest_seconds": 60,
        "swap_suggestions": [
            {"name": "Goblet squat", "detail": "Use if you want load without barbell setup."},
            {"name": "Leg press warm-up", "detail": "Hop on leg press for light sets."},
        ],
    },
    "seated_leg_curl": {
        "id": "seated_leg_curl",
        "name": "Seated Leg Curl",
        "equipment": "Leg curl machine",
        "muscle_groups": ["Hamstrings"],
        "primary_muscle": "Hamstrings",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 30, "reps": 12},
            {"set": 2, "weight": 40, "reps": 10},
            {"set": 3, "weight": 50, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Keep hips glued to the pad and pause in the shortened position.",
        "cues": ["Dorsiflex toes to engage hamstrings harder"],
        "mistakes": ["Letting hips lift off pad"],
        "rest_seconds": 90,
        "swap_suggestions": [
            {"name": "Lying leg curl", "detail": "Same machine family—use whichever is free."},
            {"name": "Smith RDL", "detail": "If curl machines are busy, hinge instead."},
        ],
    },
    "barbell_squat": {
        "id": "barbell_squat",
        "name": "Barbell Back Squat",
        "equipment": "Squat rack",
        "muscle_groups": ["Quads", "Glutes"],
        "primary_muscle": "Quads",
        "secondary_muscle": "Glutes",
        "last_session": [
            {"set": 1, "weight": 10, "reps": 10},
            {"set": 2, "weight": 15, "reps": 8},
            {"set": 3, "weight": 20, "reps": 6},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Add 2.5 kg to each side on the top set if depth stayed solid.",
        "cues": ["Big breath + brace, sit between your heels"],
        "mistakes": ["Heels lifting", "Knees caving"],
        "rest_seconds": 150,
        "swap_suggestions": [
            {"name": "Smith squat", "detail": "Use if rack is busy."},
            {"name": "Leg press", "detail": "Great hypertrophy backup."},
        ],
    },
    "lying_leg_curl": {
        "id": "lying_leg_curl",
        "name": "Lying Leg Curl",
        "equipment": "Leg curl machine",
        "muscle_groups": ["Hamstrings"],
        "primary_muscle": "Hamstrings",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 15, "reps": 12},
            {"set": 2, "weight": 20, "reps": 10},
            {"set": 3, "weight": 25, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Drive hips into the pad and imagine performing a leg drive.",
        "cues": ["Lead with heels, squeeze glutes at the top"],
        "mistakes": ["Arching lower back"],
        "rest_seconds": 90,
        "swap_suggestions": [
            {"name": "Swiss ball leg curl", "detail": "Bodyweight option if machines all busy."},
        ],
    },
    "standing_calf_raise": {
        "id": "standing_calf_raise",
        "name": "Standing Calf Raise",
        "equipment": "Bodyweight or machine",
        "muscle_groups": ["Calves"],
        "primary_muscle": "Calves",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": "BW", "reps": 24},
            {"set": 2, "weight": "BW", "reps": 24},
            {"set": 3, "weight": "BW", "reps": 24},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Add a pause at the bottom and top or hold a 10 kg plate.",
        "cues": ["Think up fast, down slow"],
        "mistakes": ["Short ROM", "Bouncing"],
        "rest_seconds": 60,
        "swap_suggestions": [
            {"name": "Leg press calf raise", "detail": "Load heavier while keeping balance."},
        ],
    },
    "decline_crunch": {
        "id": "decline_crunch",
        "name": "Decline Crunch",
        "equipment": "Decline bench",
        "muscle_groups": ["Abs"],
        "primary_muscle": "Abs",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": "BW", "reps": 15},
            {"set": 2, "weight": 10, "reps": 12},
            {"set": 3, "weight": 15, "reps": 10},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Keep rib-to-hip crunch and exhale at the top. Add 2.5 kg when all sets hit 15 reps.",
        "cues": ["Roll spine segment by segment"],
        "mistakes": ["Pulling on neck"],
        "rest_seconds": 45,
        "swap_suggestions": [
            {"name": "Hanging knee raise", "detail": "Use if decline bench is taken."},
        ],
    },
    "incline_bench_press": {
        "id": "incline_bench_press",
        "name": "Incline Bench Press",
        "equipment": "Bench + barbell",
        "muscle_groups": ["Chest", "Shoulders"],
        "primary_muscle": "Chest",
        "secondary_muscle": "Shoulders",
        "last_session": [
            {"set": 1, "weight": 40, "reps": 12},
            {"set": 2, "weight": 50, "reps": 10},
            {"set": 3, "weight": 55, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Micro-load with 1.25 kg plates or push for +1 rep.",
        "cues": ["15–20° incline only (Jeff cue)"],
        "mistakes": ["Using too steep incline and turning it into shoulders"],
        "rest_seconds": 150,
        "swap_suggestions": [
            {"name": "Smith incline press", "detail": "Great if barbell bench is taken."},
            {"name": "Incline dumbbell press", "detail": "Joints feel friendlier."},
        ],
    },
    "pec_deck_fly": {
        "id": "pec_deck_fly",
        "name": "Pec Deck Fly",
        "equipment": "Pec deck machine",
        "muscle_groups": ["Chest"],
        "primary_muscle": "Chest",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 20, "reps": 12},
            {"set": 2, "weight": 25, "reps": 10},
            {"set": 3, "weight": 30, "reps": 10},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Squeeze for two seconds and keep shoulders depressed.",
        "cues": ["Elbows slightly bent but fixed"],
        "mistakes": ["Letting shoulders roll forward"],
        "rest_seconds": 75,
        "swap_suggestions": [
            {"name": "Cable fly (high-to-low)", "detail": "Use cable stack as needed."},
        ],
    },
    "seated_cable_row": {
        "id": "seated_cable_row",
        "name": "Seated Cable Row (rope)",
        "equipment": "Cable row station",
        "muscle_groups": ["Back"],
        "primary_muscle": "Back",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 35, "reps": 12},
            {"set": 2, "weight": 40, "reps": 10},
            {"set": 3, "weight": 45, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Keep neutral spine and squeeze shoulder blades.",
        "cues": ["Drag elbows back in a straight line", "Slight pause with lats contracted"],
        "mistakes": ["Rounding lower back"],
        "rest_seconds": 90,
        "swap_suggestions": [
            {"name": "Chest-supported row", "detail": "Use dumbbells if cable busy."},
        ],
    },
    "reverse_pec_deck": {
        "id": "reverse_pec_deck",
        "name": "Reverse Pec Deck",
        "equipment": "Pec deck machine",
        "muscle_groups": ["Rear Delts"],
        "primary_muscle": "Rear Delts",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 15, "reps": 15},
            {"set": 2, "weight": 20, "reps": 12},
            {"set": 3, "weight": 20, "reps": 12},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Stay in the 12–20 rep range and chase the burn.",
        "cues": ["Lead with elbows, not hands"],
        "mistakes": ["Shrugging traps"],
        "rest_seconds": 60,
        "swap_suggestions": [
            {"name": "Cable face pull", "detail": "If machine is busy, face pulls hit the same area."},
        ],
    },
    "face_pull": {
        "id": "face_pull",
        "name": "Face Pull",
        "equipment": "Cable + rope",
        "muscle_groups": ["Rear Delts", "Upper Back"],
        "primary_muscle": "Rear Delts",
        "secondary_muscle": "Upper Back",
        "last_session": [
            {"set": 1, "weight": 15, "reps": 15},
            {"set": 2, "weight": 15, "reps": 15},
            {"set": 3, "weight": 20, "reps": 12},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Use chest height pulley and externally rotate hard.",
        "cues": ["Pull rope to nose/eyes", "Spread rope apart at the end"],
        "mistakes": ["Letting elbows drop"],
        "rest_seconds": 60,
        "swap_suggestions": [
            {"name": "Band face pull", "detail": "Carry a band for a quick setup."},
        ],
    },
    "lateral_raise": {
        "id": "lateral_raise",
        "name": "Dumbbell Lateral Raise",
        "equipment": "Dumbbells",
        "muscle_groups": ["Side Delts"],
        "primary_muscle": "Side Delts",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 7.5, "reps": 15},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Work up to 2 working sets once you can get 20 clean reps.",
        "cues": ["Lead with elbows, slight torso lean"],
        "mistakes": ["Shrugging traps", "Swinging weight"],
        "rest_seconds": 45,
        "swap_suggestions": [
            {"name": "Cable lateral raise", "detail": "Constant tension option."},
        ],
    },
    "db_overhead_triceps": {
        "id": "db_overhead_triceps",
        "name": "DB Overhead Tricep Extension",
        "equipment": "Dumbbells",
        "muscle_groups": ["Triceps"],
        "primary_muscle": "Triceps",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 12.5, "reps": 12},
            {"set": 2, "weight": 15, "reps": 10},
            {"set": 3, "weight": 17.5, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Keep elbows narrow and chase a big stretch.",
        "cues": ["Lower until forearms touch biceps"],
        "mistakes": ["Flaring elbows wide"],
        "rest_seconds": 75,
        "swap_suggestions": [
            {"name": "EZ-bar overhead extension", "detail": "Use if dumbbells are scattered."},
        ],
    },
    "hammer_curl": {
        "id": "hammer_curl",
        "name": "Hammer Curl",
        "equipment": "Dumbbells",
        "muscle_groups": ["Biceps", "Forearms"],
        "primary_muscle": "Biceps",
        "secondary_muscle": "Forearms",
        "last_session": [
            {"set": 1, "weight": 10, "reps": 12},
            {"set": 2, "weight": 12.5, "reps": 10},
            {"set": 3, "weight": 15, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Try alternating arms with a 1-second pause at top.",
        "cues": ["Thumbs toward ceiling"],
        "mistakes": ["Swinging"],
        "rest_seconds": 60,
        "swap_suggestions": [
            {"name": "Cable rope hammer curl", "detail": "Keeps tension high."},
        ],
    },
    "leg_extension": {
        "id": "leg_extension",
        "name": "Seated Leg Extension",
        "equipment": "Leg extension machine",
        "muscle_groups": ["Quads"],
        "primary_muscle": "Quads",
        "secondary_muscle": "",
        "last_session": [
            {"set": 1, "weight": 30, "reps": 15},
            {"set": 2, "weight": 35, "reps": 12},
            {"set": 3, "weight": 40, "reps": 10},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Add a 2-second peak squeeze or increase load by 2.5 kg.",
        "cues": ["Kick out fast, lower slow"],
        "mistakes": ["Swinging torso back"],
        "rest_seconds": 75,
        "swap_suggestions": [
            {"name": "Single-leg extension", "detail": "Do one leg at a time for balance."},
        ],
    },
    "smith_rdl": {
        "id": "smith_rdl",
        "name": "Smith Machine RDL",
        "equipment": "Smith machine",
        "muscle_groups": ["Hamstrings", "Glutes"],
        "primary_muscle": "Hamstrings",
        "secondary_muscle": "Glutes",
        "last_session": [
            {"set": 1, "weight": 30, "reps": 10},
            {"set": 2, "weight": 35, "reps": 8},
            {"set": 3, "weight": 40, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Focus on 3-second eccentrics and keep bar close to legs.",
        "cues": ["Push hips back like closing a car door"],
        "mistakes": ["Rounding back", "Locking knees"],
        "rest_seconds": 120,
        "swap_suggestions": [
            {"name": "Dumbbell RDL", "detail": "Use if Smith is busy."},
        ],
    },
    "leg_press": {
        "id": "leg_press",
        "name": "Leg Press",
        "equipment": "Leg press machine",
        "muscle_groups": ["Quads", "Glutes"],
        "primary_muscle": "Quads",
        "secondary_muscle": "Glutes",
        "last_session": [
            {"set": 1, "weight": 80, "reps": 12},
            {"set": 2, "weight": 100, "reps": 10},
            {"set": 3, "weight": 120, "reps": 8},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Keep depth just before hips tuck under. Add 5 kg per side when reps feel smooth.",
        "cues": ["Drive through mid-foot", "Control tempo 2-1-1"],
        "mistakes": ["Locking knees at top"],
        "rest_seconds": 120,
        "swap_suggestions": [
            {"name": "Single-leg press", "detail": "If you need more unilateral work."},
        ],
    },
    "walking_lunge": {
        "id": "walking_lunge",
        "name": "Walking Lunges",
        "equipment": "Dumbbells",
        "muscle_groups": ["Quads", "Glutes"],
        "primary_muscle": "Quads",
        "secondary_muscle": "Glutes",
        "last_session": [
            {"set": 1, "weight": "BW", "reps": 12},
            {"set": 2, "weight": "BW", "reps": 12},
            {"set": 3, "weight": "BW", "reps": 12},
        ],
        "last_performed_on": LAST_WEEK_DATE,
        "target_notes": "Add light dumbbells or slow eccentrics.",
        "cues": ["Step long, push through front heel"],
        "mistakes": ["Short steps causing knee pain"],
        "rest_seconds": 90,
        "swap_suggestions": [
            {"name": "Reverse lunge", "detail": "Knee friendly swap."},
        ],
    },
}

DEFAULT_NOTES = {
    "bench_press_barbell": "Set feet first, squeeze bar before unracking.",
    "lat_pulldown": "Think elbows in pockets + hold for 1 second.",
    "barbell_squat": "Deep breath + brace on every rep.",
}

WEEK_TEMPLATE: dict[str, dict] = {
    "sunday": {
        "label": "Sunday",
        "theme": "Upper A",
        "description": "Push + Pull foundation day (Jeff Nippard Upper Day 1).",
        "cardio": False,
        "muscles": {"chest": 4, "back": 5, "shoulders": 3, "triceps": 3, "biceps": 3},
        "exercise_order": [
            {
                "slot_id": "upperA-1",
                "name": "Warm-up",
                "subtitle": "Jumping jacks + shoulder mobility",
                "default_exercise": "warmup_mobility",
                "options": ["warmup_mobility"],
            },
            {
                "slot_id": "upperA-2",
                "name": "Push-ups",
                "subtitle": "3 × 12",
                "default_exercise": "pushups_standard",
                "options": ["pushups_standard", "bench_press_barbell"],
            },
            {
                "slot_id": "upperA-3",
                "name": "Bench Press",
                "subtitle": "3 sets · progressively heavier",
                "default_exercise": "bench_press_barbell",
                "options": ["bench_press_barbell", "incline_bench_press", "smith_shoulder_press"],
            },
            {
                "slot_id": "upperA-4",
                "name": "Assisted Pull-ups",
                "subtitle": "2 sets · 35→30 kg assist",
                "default_exercise": "assisted_pullup",
                "options": ["assisted_pullup", "lat_pulldown"],
            },
            {
                "slot_id": "upperA-5",
                "name": "Lat Pulldown",
                "subtitle": "3 sets · 25/30/35 kg",
                "default_exercise": "lat_pulldown",
                "options": ["lat_pulldown", "seated_cable_row"],
            },
            {
                "slot_id": "upperA-6",
                "name": "Shoulder Press (Smith)",
                "subtitle": "3 sets",
                "default_exercise": "smith_shoulder_press",
                "options": ["smith_shoulder_press", "lateral_raise"],
            },
            {
                "slot_id": "upperA-7",
                "name": "Tricep Rope Pushdown",
                "subtitle": "3 sets · 15/20/25 kg",
                "default_exercise": "tricep_rope_pushdown",
                "options": ["tricep_rope_pushdown", "db_overhead_triceps"],
            },
            {
                "slot_id": "upperA-8",
                "name": "Dumbbell Bicep Curls",
                "subtitle": "3 sets · 5→7.5→10 kg",
                "default_exercise": "db_biceps_curl",
                "options": ["db_biceps_curl", "hammer_curl"],
            },
        ],
    },
    "monday": {
        "label": "Monday",
        "theme": "Cardio / Run",
        "cardio": True,
        "description": "Zone 2 aerobic run + optional strides. Track calories, pace, and RPE.",
        "cardio_plan": {
            "target_runs": 1,
            "suggestions": "Aim for 20–30 minutes easy jogging. Keep HR < 150 bpm and finish with 4×20s strides.",
        },
    },
    "tuesday": {
        "label": "Tuesday",
        "theme": "Lower A",
        "cardio": False,
        "description": "Squat-dominant lower day.",
        "muscles": {"quads": 6, "hamstrings": 6, "glutes": 3, "calves": 3, "abs": 3},
        "exercise_order": [
            {
                "slot_id": "lowerA-1",
                "name": "Bodyweight Squats",
                "subtitle": "3 sets · 40/30/30 reps",
                "default_exercise": "bodyweight_squat",
                "options": ["bodyweight_squat", "walking_lunge"],
            },
            {
                "slot_id": "lowerA-2",
                "name": "Seated Leg Curl",
                "subtitle": "3 sets · 30/40/50 kg",
                "default_exercise": "seated_leg_curl",
                "options": ["seated_leg_curl", "lying_leg_curl", "smith_rdl"],
            },
            {
                "slot_id": "lowerA-3",
                "name": "Barbell Squats",
                "subtitle": "3 sets · 10→15→20 kg plates",
                "default_exercise": "barbell_squat",
                "options": ["barbell_squat", "leg_press", "smith_rdl"],
            },
            {
                "slot_id": "lowerA-4",
                "name": "Lying Leg Curl",
                "subtitle": "3 sets · 15/20/25 kg",
                "default_exercise": "lying_leg_curl",
                "options": ["lying_leg_curl", "seated_leg_curl", "smith_rdl"],
            },
            {
                "slot_id": "lowerA-5",
                "name": "Standing Calf Raises",
                "subtitle": "3 × 24",
                "default_exercise": "standing_calf_raise",
                "options": ["standing_calf_raise", "leg_press"],
            },
            {
                "slot_id": "lowerA-6",
                "name": "Decline Crunches",
                "subtitle": "3 sets · BW → 10 kg → 15 kg",
                "default_exercise": "decline_crunch",
                "options": ["decline_crunch"],
            },
        ],
    },
    "wednesday": {
        "label": "Wednesday",
        "theme": "Cardio / Run",
        "cardio": True,
        "description": "Intervals or tempo running to complement lower days.",
        "cardio_plan": {
            "target_runs": 1,
            "suggestions": "8-min warm-up jog, then 6×1 min fast / 1 min easy. Record peak pace.",
        },
    },
    "thursday": {
        "label": "Thursday",
        "theme": "Upper B",
        "cardio": False,
        "description": "Incline + back focus with accessory delts/arms.",
        "muscles": {"chest": 6, "back": 6, "rearDelts": 3, "sideDelts": 1, "triceps": 3, "biceps": 3},
        "exercise_order": [
            {
                "slot_id": "upperB-1",
                "name": "Incline Bench Press",
                "subtitle": "3 sets · 40/50/55 kg",
                "default_exercise": "incline_bench_press",
                "options": ["incline_bench_press", "bench_press_barbell", "smith_shoulder_press"],
            },
            {
                "slot_id": "upperB-2",
                "name": "Pec Deck Fly",
                "subtitle": "3 sets · 20/25/30 kg",
                "default_exercise": "pec_deck_fly",
                "options": ["pec_deck_fly", "lat_pulldown"],
            },
            {
                "slot_id": "upperB-3",
                "name": "Seated Cable Row (Rope)",
                "subtitle": "3 sets",
                "default_exercise": "seated_cable_row",
                "options": ["seated_cable_row", "assisted_pullup"],
            },
            {
                "slot_id": "upperB-4",
                "name": "Reverse Pec Deck (Rear Delt Fly)",
                "subtitle": "3 sets",
                "default_exercise": "reverse_pec_deck",
                "options": ["reverse_pec_deck", "face_pull"],
            },
            {
                "slot_id": "upperB-5",
                "name": "Face Pulls",
                "subtitle": "3 sets",
                "default_exercise": "face_pull",
                "options": ["face_pull", "reverse_pec_deck"],
            },
            {
                "slot_id": "upperB-6",
                "name": "Lateral Raise",
                "subtitle": "1 set",
                "default_exercise": "lateral_raise",
                "options": ["lateral_raise", "smith_shoulder_press"],
            },
            {
                "slot_id": "upperB-7",
                "name": "DB Overhead Tricep Extension",
                "subtitle": "3 sets",
                "default_exercise": "db_overhead_triceps",
                "options": ["db_overhead_triceps", "tricep_rope_pushdown"],
            },
            {
                "slot_id": "upperB-8",
                "name": "Hammer Curls",
                "subtitle": "3 sets",
                "default_exercise": "hammer_curl",
                "options": ["hammer_curl", "db_biceps_curl"],
            },
        ],
    },
    "friday": {
        "label": "Friday",
        "theme": "Lower B",
        "cardio": False,
        "description": "Leg extensions + hinges + unilateral work.",
        "muscles": {"quads": 6, "hamstrings": 3, "glutes": 3, "calves": 3, "abs": 3},
        "exercise_order": [
            {
                "slot_id": "lowerB-1",
                "name": "Seated Leg Extension",
                "subtitle": "3 sets",
                "default_exercise": "leg_extension",
                "options": ["leg_extension", "bodyweight_squat"],
            },
            {
                "slot_id": "lowerB-2",
                "name": "Smith Machine Deadlift (RDL)",
                "subtitle": "3 sets",
                "default_exercise": "smith_rdl",
                "options": ["smith_rdl", "barbell_squat", "lying_leg_curl"],
            },
            {
                "slot_id": "lowerB-3",
                "name": "Leg Press",
                "subtitle": "3 sets",
                "default_exercise": "leg_press",
                "options": ["leg_press", "barbell_squat"],
            },
            {
                "slot_id": "lowerB-4",
                "name": "Calf Raises",
                "subtitle": "3 sets",
                "default_exercise": "standing_calf_raise",
                "options": ["standing_calf_raise", "leg_press"],
            },
            {
                "slot_id": "lowerB-5",
                "name": "Lunges",
                "subtitle": "3 sets per leg",
                "default_exercise": "walking_lunge",
                "options": ["walking_lunge", "bodyweight_squat"],
            },
            {
                "slot_id": "lowerB-6",
                "name": "Decline Crunches",
                "subtitle": "3 sets",
                "default_exercise": "decline_crunch",
                "options": ["decline_crunch"],
            },
        ],
    },
    "saturday": {
        "label": "Saturday",
        "theme": "Rest / Restore",
        "cardio": False,
        "description": "Mobility, long walk, or low-key hobby workout. Log recovery metrics and readiness score.",
        "focus": "Sleep 8+ hours, optional stretching session.",
    },
}

CARDIO_EXERCISES = {
    "cardio_monday": {
        "id": "cardio_monday",
        "name": "Zone 2 Run",
        "equipment": "Road / treadmill",
        "muscle_groups": ["Cardio"],
        "primary_muscle": "Cardio",
        "secondary_muscle": "",
        "last_session": [],
        "rest_seconds": 0,
        "target_notes": "Keep HR < 150 bpm and finish with strides.",
        "metadata": {"cardio": True, "day_key": "monday"},
    },
    "cardio_wednesday": {
        "id": "cardio_wednesday",
        "name": "Tempo Intervals",
        "equipment": "Road / treadmill",
        "muscle_groups": ["Cardio"],
        "primary_muscle": "Cardio",
        "secondary_muscle": "",
        "last_session": [],
        "rest_seconds": 0,
        "target_notes": "Intervals 6×1 min fast / 1 min easy.",
        "metadata": {"cardio": True, "day_key": "wednesday"},
    },
}

DEFAULT_EXERCISES.update(CARDIO_EXERCISES)

DEFAULT_HISTORY = {
    exercise_id: [
        {
            "date": data.get("last_performed_on", LAST_WEEK_DATE),
            "sets": data.get("last_session", []),
            "day_key": None,
            "slot_id": None,
            "notes": DEFAULT_NOTES.get(exercise_id, ""),
        }
    ]
    if data.get("last_session")
    else []
    for exercise_id, data in DEFAULT_EXERCISES.items()
}
